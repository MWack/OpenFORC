<!DOCTYPE html>

<script src="https://unpkg.com/vue@3"></script>
<script src="https://unpkg.com/vue-router@4"></script>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <link rel="stylesheet" href="nav.css">
  <link rel="stylesheet" href="main.css">
</head>

<div id="app">
  <h1>Toolbox</h1>
  <div class="alert" v-if="!pyodideLoaded">
  Please wait while Pyodide is loading...
  </div>
  <div class="ready" v-else>
     Pyodide ready.
  </div>
  <!-- add navigation bar on top -->
  <navigation></navigation>
  <!-- route outlet -->
  <!-- component matched by the route will render here -->
  <router-view></router-view>
</div>


<script src="https://cdn.jsdelivr.net/pyodide/v0.19.1/full/pyodide.js"></script>
<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>

<script>
var pyodide = false
</script>

<script type="module">
// 1. Define route components.
// These can be imported from other files
import Nav from './nav.js'
import Home from './home.js'
import Tensor from './anisotropy/tensor.js'

const About = { template: '<div>About</div>' }

// 2. Define some routes
// Each route should map to a component.
// We'll talk about nested routes later.
const routes = [
  { path: '/', component: Home },
  { path: '/tensor', component: Tensor },
  { path: '/about', component: About },
]

// 3. Create the router instance and pass the `routes` option
// You can pass in additional options here, but let's
// keep it simple for now.
const router = VueRouter.createRouter({
  // 4. Provide the history implementation to use. We are using the hash history for simplicity here.
  history: VueRouter.createWebHashHistory(),
  routes, // short for `routes: routes`
})

//Vue.prototype.$pyodide = false

// 5. Create and mount the root instance.
const app = Vue.createApp({
  data: () => ({
    pyodideLoaded: false,
  }),
  methods: {
	initializePyodide: async function () {
      
      /*let pyodideScript = document.createElement('script')
      pyodideScript.setAttribute('src', 'https://cdn.jsdelivr.net/pyodide/v0.19.1/full/pyodide.js')
      document.head.appendChild(pyodideScript)*/
      
	  
	  pyodide = await loadPyodide({indexURL: "https://cdn.jsdelivr.net/pyodide/v0.19.1/full/",});
	  await pyodide.loadPackage("scipy");
	  //await pyodide.loadPackage("numpy");
	  await pyodide.loadPackage("pandas");
	  await pyodide.loadPackage("micropip");

	  await pyodide.runPythonAsync(`
        import micropip
        print("installing plotly...")
        await micropip.install('plotly')
        print("installing munmagtools...")
        await micropip.install('https://mwack.github.io/OpenFORC/munmagtools-0.0.1-py3-none-any.whl')
        #package_list = micropip.list()
        #print(package_list) 
        import pandas as pd
        import plotly
        import numpy as np
        import munmagtools
        import munmagtools.anisotropy.tensorfit as tf
      `);

	  this.pyodideLoaded = true;
	  console.log("pyodide loaded")
    },
  },
  mounted: async function () {
	    console.log("app mounted");
        await this.initializePyodide();
  },
});

// Make sure to _use_ the router instance to make the
// whole app router-aware.
app.use(router);
app.component('navigation', Nav);  // register navigation bar as component
//app.config.globalProperties.pyodideLoaded = false
app.mount('#app');

// Now the app has started!

</script>
